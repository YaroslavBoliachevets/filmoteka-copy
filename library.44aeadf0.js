const e=new class{async fetchPopularMovies(){const e=await fetch("https://api.themoviedb.org/3/trending/all/day?api_key=5692dca6012d3660a336300872bd664c");return await e.json()}saveToLocalStorageFindedFilms(e){localStorage.setItem("findFilms",JSON.stringify(e.results))}saveToLibraryMovieInLS(e,t){let a=this.getFromLS(`${t}`);a||(a=[]),a.push(e),localStorage.setItem(`${t}`,JSON.stringify(a))}removeFromLibraryMovieInLS(e,t){let a=this.getFromLS(`${t}`);const n=a.findIndex((t=>t.id==e.id));a.splice(n,1),localStorage.setItem(`${t}`,JSON.stringify(a))}changeModalBtnName(e,t){}getFromLS(e){const t=localStorage.getItem(`${e}`);try{return JSON.parse(t)}catch(e){"SyntaxError"===e.name&&console.log("Ошибка парса JSON")}}isModalFilmIncludesLS(t,a){const n=e.getFromLS(a);return n.find((e=>{e.id}))}modifyDate(e,t){return e?e.slice(0,4):t?t.slice(0,4):""}modifyGenres(e){const t=[];for(let n of e)if(null!==a[n]&&void 0!==a[n]){if(2===t.length){t.push("Other");break}t.push(a[n])}return Object.values(t).join(", ")}makeGenresList(e,t){const a=[];for(let n of e)if(null!==t[n]&&void 0!==t[n]){if(2===a.length){a.push("Other");break}a.push(t[n].name)}return Object.values(a).join(", ")}makeAllMoodalGenresList(e,t){const a=[];for(let n of e)null!==t[n]&&void 0!==t[n]&&a.push(t[n].name);return Object.values(a).join(", ")}parseFindedFilms(){const e=localStorage.getItem("findFilms");let t=[];try{t=JSON.parse(e)}catch(e){"SyntaxError"===e.name&&console.log("Ошибка парса JSON")}return t}searchFilmByIdInLS(t){return e.parseFindedFilms().find((e=>{if(e.id==t)return e}))}constructor(){this.storageWatched=[],this.storageQueue=[]}};const t=new class{changeGenresToBeUsable(e,t={}){e.genres.map((e=>(t[e.id]=e.name,t)))}async parseGenres(){await this.saveGenres();const e=localStorage.getItem("genres");let t={};try{t=JSON.parse(e)}catch(e){console.log(e),"SyntaxError"===e.name&&console.log("Ошибка парса JSON")}return t}async saveGenres(){try{return await this.fetchGenresList().then((e=>{const t={};return this.changeGenresToBeUsable(e,t),localStorage.setItem("genres",JSON.stringify(t))}))}catch(e){console.log(e)}}async fetchGenresList(){const e=await fetch("https://api.themoviedb.org/3/genre/movie/list?api_key=5692dca6012d3660a336300872bd664c&language=en-US");return await e.json()}makeGenresArrayMarkup(e,t){const a=[];for(id of e)if(null!==t[id]&&void 0!==t[id]){if(2===a.length){a.push("Other");break}a.push(t[id])}return Object.values(a).join(", ")}constructor(){}},a=(t.parseGenres(),t.parseGenres());var n=genres=[{id:28,name:"Action"},{id:12,name:"Adventure"},{id:16,name:"Animation"},{id:35,name:"Comedy"},{id:80,name:"Crime"},{id:99,name:"Documentary"},{id:18,name:"Drama"},{id:10751,name:"Family"},{id:14,name:"Fantasy"},{id:36,name:"History"},{id:27,name:"Horror"},{id:10402,name:"Music"},{id:9648,name:"Mystery"},{id:10749,name:"Romance"},{id:878,name:"Science Fiction"},{id:10770,name:"TV Movie"},{id:53,name:"Thriller"},{id:10752,name:"War"},{id:37,name:"Western"}];function r({original_title:t,original_name:a,id:r,genre_ids:o,release_date:i,first_air_date:l,poster_path:s}){return t||(t=a),`<li class="gallery_card__item" data-id=${r}>\n  <a href="./" class="gallery_card__link">\n      <div class="gallery_thumb">\n          <img src=https://image.tmdb.org/t/p/w500${s} alt="movie cover" loading='lazy' class="gallery_card__img">\n      </div>\n      <div class="gallery_info">\n          <h3 class="gallery_info__name">${t}</h3>\n          <div class = "gallery_info__about">\n              <p class = "gallery_info__genres">${e.makeGenresList(o,n)}</p>\n              <p class = "gallery_info__separator">|</p>\n              <p class = "gallery_info__year">${e.modifyDate(i,l)}</p>\n          </div>\n      </div>\n  </a>\n</li>`}const o={gallery:document.querySelector(".js-gallery__list"),backdrop:document.querySelector("#backdrop"),body:document.querySelector("body"),btnCloseModalFilm:document.querySelector("#btn-close-modal"),imageModal:document.querySelector("#imageModal"),modalTitle:document.querySelector("#title"),modalTitleOriginal:document.querySelector("#titleOriginal"),voteModal:document.querySelector("#vote"),votesModal:document.querySelector("#votes"),popularityModal:document.querySelector("#popularity"),genreModal:document.querySelector("#genre"),overviewModal:document.querySelector("#overview"),gallery:document.querySelector(".js-gallery__list"),modalBtn:document.querySelector(".js-modal-button"),searchForm:document.querySelector(".search"),searchError:document.querySelector(".search-error"),searchFormContainer:document.querySelector(".search-form-container"),modalBtnWatched:document.querySelector('[data-actions="watched"]'),modalBtnQueue:document.querySelector('[data-actions="queue"]')};!async function(){await e.fetchPopularMovies().then((t=>(e.saveToLocalStorageFindedFilms(t),o.gallery.insertAdjacentHTML("beforeend",t.results.map((e=>r(e))).join("")))))}();const i=new class{isFilmIncludesLSLibrary(t,a){const n=e.getFromLS(`${a}`);return null!==n&&n.find((e=>{if(e.id==t)return!0}))}isFilmIncludesLSQueue(t){const a=e.getFromLS("queue");return null!==a&&a.find((e=>{if(e.id==t)return!0}))}changeWatchedBtnName(){o.modalBtnWatched.textContent="in watched list"}isFilmIncludesLSQueue(){o.modalBtnWatched.textContent="in queue list"}};function l(){o.searchFormContainer.style.display=null,o.backdrop.classList.add("is-hidden"),o.body.classList.remove("backdrop-body-block-scroll")}function s(e,t,a){i.isFilmIncludesLSLibrary(e,a)?t.textContent=`remove from ${a}`:t.textContent=`add to ${a}`}o.gallery.addEventListener("click",(function(t){t.preventDefault(),o.imageModal.src="",o.modalTitle.textContent="",o.modalTitleOriginal.textContent="",o.voteModal.textContent="",o.votesModal.textContent="",o.popularityModal.textContent="",o.genreModal.textContent="",o.overviewModal.textContent="";const a=t.target.closest("li");if(!a)return;const r=a.getAttribute("data-id"),i=e.searchFilmByIdInLS(r),l=e.makeAllMoodalGenresList(i.genre_ids,n);o.searchFormContainer.style.display="none";const d="https://image.tmdb.org/t/p/w500";o.modalBtnQueue.setAttribute("data-id",`${r}`),o.modalBtnWatched.setAttribute("data-id",`${r}`),o.imageModal.src=`${d}${i.poster_path}`,o.modalTitle.textContent=`${i.title?i.title:i.name}`,o.modalTitleOriginal.textContent=`${i.original_title?i.original_title:i.original_name}`,o.voteModal.textContent=`${i.vote_average.toFixed(2)}`,o.votesModal.textContent=`${i.vote_count}`,o.popularityModal.textContent=`${i.popularity}`,o.genreModal.textContent=`${l}`,o.overviewModal.textContent=`${i.overview}`,o.backdrop.style.background=`url(${d}${i.backdrop_path}) no-repeat center`,o.backdrop.style.backgroundSize="cover",o.backdrop.classList.remove("is-hidden"),o.body.classList.add("backdrop-body-block-scroll"),s(r,o.modalBtnWatched,o.modalBtnWatched.getAttribute("data-actions")),s(r,o.modalBtnQueue,o.modalBtnQueue.getAttribute("data-actions"))})),o.btnCloseModalFilm.addEventListener("click",l),window.addEventListener("keydown",(function(e){"Escape"===e.key&&l()})),o.backdrop.addEventListener("click",(function(e){e.target===e.currentTarget&&l()})),o.searchForm&&o.searchForm.addEventListener("submit",(function(t){t.preventDefault();const{elements:{search:a}}=t.currentTarget;searchQuery=a.value.trim(),""!==searchQuery&&(!async function(t){await async function(e){try{d=1;const t=await fetch(`https://api.themoviedb.org/3/search/movie?api_key=5692dca6012d3660a336300872bd664c&language=en-US&page=${d}&include_adult=false&query=${e}`);return await t.json()}catch(e){console.log(e)}}(t).then((t=>{if(0!==t.total_results)return e.saveToLocalStorageFindedFilms(t),o.gallery.innerHTML="",o.gallery.insertAdjacentHTML("beforeend",t.results.map((e=>r(e))).join(""));o.searchError.style.visibility="visible",setTimeout(c,2e3)}))}(searchQuery),t.currentTarget.reset());return searchQuery}));let d=1;const c=()=>{o.searchError.style.visibility="hidden"};o.modalBtn.addEventListener("click",(function(t){t.preventDefault();const a=t.target.closest("li");if(!a)return;const n=a.getAttribute("data-id"),r=a.getAttribute("data-actions"),o=e.searchFilmByIdInLS(n);i.isFilmIncludesLSLibrary(n,r)?e.removeFromLibraryMovieInLS(o,r):e.saveToLibraryMovieInLS(o,r)}));const m={body:document.querySelector("body"),infoNames:document.querySelectorAll(".gallery_info__name"),themeBtn:document.querySelector(".theme-toggle"),lightToggleIcon:document.querySelector(".lightToggleIcon"),darkToggleIcon:document.querySelector(".darkToggleIcon")};theme=localStorage.getItem("preference-theme"),"light"===theme?(m.body.classList.remove("dark"),m.themeBtn.classList.add("js-light"),m.lightToggleIcon.classList.remove("is-hidden"),m.darkToggleIcon.classList.add("is-hidden")):(m.body.classList.add("dark"),m.themeBtn.classList.remove("js-light"),m.lightToggleIcon.classList.add("is-hidden"),m.darkToggleIcon.classList.remove("is-hidden")),m.themeBtn.addEventListener("click",(function(e){e.preventDefault();m.themeBtn.classList.toggle("js-light")?(theme="light",m.body.classList.remove("dark"),m.darkToggleIcon.classList.add("is-hidden"),m.lightToggleIcon.classList.remove("is-hidden")):(theme="dark",m.body.classList.add("dark"),m.lightToggleIcon.classList.add("is-hidden"),m.darkToggleIcon.classList.remove("is-hidden"));localStorage.setItem("preference-theme",theme)}));
//# sourceMappingURL=library.44aeadf0.js.map
